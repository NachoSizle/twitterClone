{"version":3,"sources":["meteor://ðŸ’»app/lib/collections/notifications.js","meteor://ðŸ’»app/lib/collections/tweets.js","meteor://ðŸ’»app/lib/router.js","meteor://ðŸ’»app/lib/userUtils.js","meteor://ðŸ’»app/server/followUsers.js","meteor://ðŸ’»app/server/notifications.js","meteor://ðŸ’»app/server/publications.js","meteor://ðŸ’»app/server/tweetBox.js","meteor://ðŸ’»app/server/userManagement.js","meteor://ðŸ’»app/server/main.js"],"names":[],"mappings":"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","file":"/app.js","sourcesContent":["Notifications = new Mongo.Collection('notifications');","Twitts = new Meteor.Collection('twitts');\r\nRelationships = new Meteor.Collection('relationships');","Router.configure({\r\n  loadingTemplate: 'loading',\r\n  notFoundTemplate: 'notFound',\r\n});\r\n\r\nRouter.route('/', {name: 'userManagement'});\r\n/*SE ACCEDE POR WINDOW.LOCATION*/\r\nRouter.route('/whoToFollow', {name: 'followUsers'});\r\nRouter.route('/myProfile', {name: 'userProfile'});\r\nRouter.route('/Notifications', {name: 'twiitPageNew'});\r\n/*SE ACCEDE POR PATHFOR*/\r\nRouter.route('/twiits/:_id', {\r\n  name: 'twiitPage',\r\n  data: function() { \r\n  \treturn this.params;\r\n  }\r\n});","UserUtils = function() {};    //no var in front\r\n\r\nUserUtils.findTweets = function(username) { \r\n  var currentTweets = Twitts.find({ user: username }).fetch().map(function(data) {\r\n    \t\t\t\t\t\t\t\treturn data.following;\r\n  \t\t\t\t\t\t  });\r\n  console.log(\"Tweets: \");\r\n  console.log(currentTweets);\r\n\r\n  return currentTweets;\r\n};\t\r\n\r\nUserUtils.findFollowings = function(username) { \r\n  var currentFollowings = Relationships.find({ follower: username }).fetch().map(function(data) {\r\n    \t\t\t\t\t\t\t\treturn data.following;\r\n  \t\t\t\t\t\t  });\r\n  //console.log(\"Siguiendo: \");\r\n  //console.log(currentFollowings);\r\n\r\n  return currentFollowings;\r\n};\t\r\n\r\nUserUtils.findFollowers = function(username) { \r\n  var currentFollowers = Relationships.find({ following: username }).fetch().map(function(data) {\r\n    \t\t\t\t\t\t\t\treturn data.following;\r\n  \t\t\t\t\t\t  });\r\n  //console.log(\"Seguidores: \");\r\n  //console.log(currentFollowers);\r\n\r\n  return currentFollowers;\r\n};\t\r\n\r\n//FORZAMOS LA REACTIVIDAD\r\nUserUtils.observerProperties = function(){\r\n\tTwitts.find().observeChanges({\r\n    changed: function(){\r\n      console.log(\"Se han detectado cambios!\");\r\n    },\r\n    added: function(id, doc) {\r\n      //console.log(doc);\r\n      return true;\r\n    }\r\n  })\r\n}\r\n\r\nUserUtils.findNumberNotif = function(username){\r\n  var followings = UserUtils.findFollowings();\r\n  return Notifications.find({twiitNotifUserName: { $nin: followings }, read: false}).count();\r\n};","Meteor.methods({ \r\n  'findUser': function(username) {\r\n    return Meteor.users.findOne({\r\n      username: username\r\n    }, {\r\n      fields: { 'username': 1 }\r\n    });\r\n  },\r\n\r\n  'followUser': function(username) {\r\n    Relationships.insert({\r\n      follower: Meteor.user().username,\r\n      following: username\r\n    });\r\n  },\r\n\r\n  'recommendUsers': function() {\r\n\tif (Meteor.user()) {\r\n\t  var currentFollowings = UserUtils.findFollowings(Meteor.user().username);\r\n\r\n\t  var recUsers = Meteor.users.find({\r\n\t    username: {\r\n\t      $nin: currentFollowings\r\n\t    }\r\n\t  }, {\r\n\t    fields: { 'username': 1 },\r\n\t    limit: 5\r\n\t  }).fetch();\r\n\t  return recUsers;\r\n\t}\r\n   }\r\n});\r\n\r\n\r\n","Notifications.allow({\r\n  update: function(userId, doc) {\r\n    //console.log(userId);\r\n    console.log(\"Update\");\r\n    //console.log(fieldNames);\r\n    //Notifications.update({ _id: doc.twiitId }, { $set: {read: true }});\r\n    return true;\r\n  }\r\n});\r\n\r\nMeteor.methods({ \r\n  'createTwiitNotification' : function(twiitNotifId) {\r\n    var twiit = Twitts.findOne(twiitNotifId);\r\n\r\n    Notifications.insert({\r\n      twiitMessage: twiit.message,\r\n      twiitId: twiit._id,\r\n      twiitNotifUserName: twiit.user,\r\n      twiitTimeStamp: twiit.timestamp,\r\n      read: false\r\n    });\r\n  }\r\n});","Meteor.publish('twitts', function() {  \r\n  if (Meteor.userId) {\r\n    var username = Meteor.users.findOne({_id: this.userId}).username;\r\n    var currentFollowings = UserUtils.findFollowings(username);\r\n\r\n    return Twitts.find({user: { $in: currentFollowings }});\r\n  }\r\n});\r\n\r\nMeteor.publish('twittsProfile', function(username) {  \r\n  if (Meteor.userId) {\r\n    var username = Meteor.users.findOne({_id: this.userId}).username;\r\n    //var currentFollowings = UserUtils.findFollowings(username);\r\n\r\n    //return Twitts.find({user: { $in: currentFollowings }});\r\n    return Twitts.find({user: username});\r\n  }\r\n});\r\n\r\nMeteor.publish('notifications', function(username) {\r\n  console.log(username);\r\n  var currentFollowings = UserUtils.findFollowings(username);\r\n  console.log(Notifications.find({twiitNotifUserName: { $in: currentFollowings }, read: false}).count());\r\n  return Notifications.find({twiitNotifUserName: { $in: currentFollowings }, read: false});\r\n});\r\n/*\r\nMeteor.publishComposite('twitts', function(username) {  \r\n  return {\r\n    find: function() {\r\n      // Comprobar los usuarios a los que se estÃ¡ siguiendo\r\n      return Relationships.find({ follower: username });\r\n    },\r\n    children: [{\r\n      find: function(relationship) {\r\n        // Encontrar mensajes de los usuarios que se siguen\r\n        return Twitts.find({user: relationship.following});\r\n      }\r\n    }]\r\n  }\r\n});\r\n*/","Meteor.methods({ \r\n  'insertTweet': function(tweet) {\r\n  \t/*\r\n  \ttwiit = _.extend(tweet, {\r\n      user: Meteor.user().username,\r\n      message: tweet,\r\n      timestamp: new Date()\r\n    });\r\n    */\r\n    twiit = new Object();\r\n    twiit.message = tweet;\r\n    twiit.user = Meteor.user().username;\r\n    twiit.timestamp = new Date();\r\n\r\n    if (Meteor.user()) {\r\n      twiit._id = Twitts.insert({\r\n        message : twiit.message,\r\n        user : twiit.user,\r\n        timestamp : twiit.timestamp \r\n      });\r\n    }\r\n\tMeteor.call('createTwiitNotification', twiit._id);\r\n  }\r\n});","Meteor.methods({ \r\n  'tweetsPublish': function(username) {\r\n    console.log(\"Usuario a buscar: \" + username);\r\n    console.log(\"Resultado: \");\r\n    var resul =  UserUtils.findTweets(Meteor.user().username);\r\n    return resul.length;\r\n  },\r\n  \r\n  'usersFollowers': function() {\r\n    var currentFollowers = UserUtils.findFollowers(Meteor.user().username);\r\n    return currentFollowers.length;\r\n  },\r\n\r\n  'usersFollowings': function() {\r\n\t  var currentFollowings = UserUtils.findFollowings(Meteor.user().username);\r\n    \r\n    return currentFollowings.length;\r\n  }\r\n});","import { Meteor } from 'meteor/meteor';\n\nMeteor.startup(() => {\n  // code to run on server at startup\n  Relationships._ensureIndex({follower: 1, following: 1}, {unique: 1});\n  \n  Twitts.allow({\n\tinsert: function(userId, disconnect) {\n\t   return true;\n\t}\n  });\n});\n"]}